! =============================================================================
! IBN Platform Generated Configuration - Arista EOS
! =============================================================================
! Hostname: {{ config.hostname }}
! Intent: {{ intent.name }}
! Service: {{ service.name }}
! Generated by IBN Platform
! =============================================================================
!
! WARNING: This configuration is managed by IBN Platform.
! Manual changes may be overwritten.
!
! =============================================================================

! === HOSTNAME ===
hostname {{ config.hostname }}
!

! === BGP CONFIGURATION ===
router bgp {{ config.bgp_as }}
   router-id {{ config.router_id }}
   !
   ! --- BGP Neighbors ---
{% for neighbor in config.neighbors %}
   ! {{ "PRIMARY" if neighbor.is_primary else "BACKUP" }} path via {{ neighbor.name }}
   neighbor {{ neighbor.ip }} remote-as {{ neighbor.remote_as }}
   neighbor {{ neighbor.ip }} description {{ neighbor.name }}
{% if service.bfd.enabled %}
   neighbor {{ neighbor.ip }} bfd
{% endif %}
   neighbor {{ neighbor.ip }} route-map {{ neighbor.route_map_in }} in
{% endfor %}
   !
   ! --- Address Family IPv4 ---
   address-family ipv4
{% for neighbor in config.neighbors %}
      neighbor {{ neighbor.ip }} activate
{% endfor %}
{% for network in config.advertise_networks %}
      {{ network }}
{% endfor %}
!

! === ROUTE-MAPS ===
{% for rm in config.route_maps %}
route-map {{ rm.name }} permit 10
   set local-preference {{ rm.local_preference }}
   set community {{ rm.community }}
!
{% endfor %}

! === INTERFACE CONFIGURATION ===
{% for iface in config.interfaces %}
interface {{ iface.name }}
   description {{ iface.description }}
   ip address {{ iface.ip_address }}/{{ iface.subnet_mask | replace('255.255.255.252', '30') | replace('255.255.255.0', '24') }}
{% if iface.bfd_enabled %}
   bfd interval {{ iface.bfd_interval }} min-rx {{ iface.bfd_min_rx }} multiplier {{ iface.bfd_multiplier }}
{% endif %}
   no shutdown
!
{% endfor %}

! === END IBN CONFIGURATION ===
